- hosts: all
  tasks:
    - name: Create groups based on the OS
      group_by:
        key: "{{ ansible_network_os.split('.')[2] | lower }}"
      when:
        - ansible_network_os is defined

- hosts: all:!localhost
  strategy: free
  roles:
    - bloodymage.rebeldream.hostname
    - bloodymage.rebeldream.hosts
    - bloodymage.rebeldream.system_upgrade

- hosts: all:!localhost:!routeros
  roles:
    - bloodymage.rebeldream.sshca_host_certs
    - bloodymage.rebeldream.openssh
    - bloodymage.rebeldream.ntp

- hosts: all:!localhost
  strategy: free
  roles:
    - bloodymage.rebeldream.users
    - bloodymage.rebeldream.ownca_host_certs

- hosts: all:!localhost:!routeros
  roles:
    - bloodymage.rebeldream.global_packages
    - bloodymage.rebeldream.sudo
    - bloodymage.rebeldream.skel
    - bloodymage.rebeldream.dotfiles
    - bloodymage.rebeldream.etckeeper
