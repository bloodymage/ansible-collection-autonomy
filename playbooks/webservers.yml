- hosts: redis_servers
  roles:
    - role: bloodymage.autonomy.redis
      tags:
        redis

- hosts: apache_servers:!public_zone
  roles:
    - role: bloodymage.autonomy.apache

- hosts: nginx_servers
  roles:
    - role: bloodymage.autonomy.nginx

# ==================================================================================================
#
# This needs to go before the next group for all webservers because while this group definitely
# depends on an ACME CA working, the next group may depend on an ACME CA working.
#
# ==================================================================================================
- hosts: web_servers:&public_zone
  roles:
    - role: bloodymage.autonomy.acmeca_challenge_site
      tags:
        - acmeca-challenge-site
    - role: bloodymage.autonomy.config_acmeca_environment
    - role: bloodymage.autonomy.acmeca_host_certs
      tags:
        - acmeca_host_certs
        - acmeca-host-certs
    - role: bloodymage.autonomy.nextcloud
      tags:
        - nextcloud
    - role: bloodymage.autonomy.ownca_crl_distribution_points
      tags:
        - ownca-crl-distribution-points
        - ownca_crl_distribution_points

- hosts: web_servers
  roles:
    - role: bloodymage.autonomy.mediawiki
      tags:
        - mediawiki
        - mediawiki_debug
        - mediawiki-debug
    # - role: bloodymage.autonomy.drush
    # - role: bloodymage.autonomy.drupal
