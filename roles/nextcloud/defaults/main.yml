---
# defaults file for nextcloud
__packages_base:
  - apache2
  - php-gd
  - php-mysql
  - php-curl
  - php-mbstring
  - php-intl
  - php-gmp
  - php-bcmath
  - php-imagick
  - php-xml
  - php-zip

__packages_ldap:
  - php-ldap

__packages_gnupg:
  - php-gnupg

__packages_redis:
  - php-redis

packages: "{{ __packages_base + __packages_ldap + __packages_gnupg + __packages_redis }}"

# Required:
# PHP (7.2, 7.3 or 7.4)
# PHP module ctype
# PHP module dom
# PHP module hash (only on FreeBSD)
# PHP module iconv
# PHP module JSON
# PHP module libxml (Linux package libxml2 must be >=2.7.0)
# PHP module openssl
# PHP module posix
# PHP module session
# PHP module SimpleXML
# PHP module XMLReader
# PHP module XMLWriter
# PHP module zlib

# Recommended packages:
# PHP module fileinfo (highly recommended, enhances file analysis performance)
# PHP module bz2 (recommended, required for extraction of apps)

# Required for specific apps:
# PHP module smbclient (SMB/CIFS integration, see SMB/CIFS)
# PHP module ftp (for FTP storage / external user authentication)
# PHP module imap (for external user authentication)

# Recommended for specific apps (optional):
# PHP module exif (for image rotation in pictures app)

# For enhanced server performance (optional) select one of the following memcaches:
# PHP module apcu (>= 4.0.6)
# PHP module memcached

# For preview generation (optional):
# avconv or ffmpeg
# OpenOffice or LibreOffice

# For command line processing (optional):
# PHP module pcntl (enables command interruption by pressing ctrl-c)

nextcloud_public_gpg_key: "https://nextcloud.com/nextcloud.asc"
nextcloud_version: "20.0.3"
nextcloud_source_url:
  - source: "https://download.nextcloud.com/server/releases/nextcloud-{{ nextcloud_version }}.tar.bz2"
    file: "nextcloud-{{ nextcloud_version }}.tar.bz2"
    signature: "https://download.nextcloud.com/server/releases/nextcloud-{{ nextcloud_version }}.tar.bz2.asc"
    checksum: "https://download.nextcloud.com/server/releases/nextcloud-{{ nextcloud_version }}.tar.bz2.sha256"

nextcloud_admin_user: "administrator"
nextcloud_admin_password: "password"
nextcloud_ldap_password: "password"
nextcloud_password_legnth: "{{ rebeldream_password_length }}"

nextcloud_post_max_size: "512M"
nextcloud_upload_max_filesize: "512M"
nextcloud_memory_limit: "512M"
nextcloud_hsts_max_age: 15552000

nextcloud_data_directory: "/srv/www-data/nextcloud/"

nextcloud_apps:
  - accessibility
  - activity
  - admin_audit
  - cloud_federation_api
  - comments
  - contactsinteraction
  - dashboard
  - dav
  - federatedfilesharing
  - federation
  - files
  - files_external
  - files_rightclick
  - files_sharing
  - files_trashbin
  - files_versions
  - firstrunwizard
  - logreader
  - lookup_server_connector
  - notifications
  - oauth2
  - password_policy
  - photos
  - privacy
  - provisioning_api
  - recommendations
  - serverinfo
  - settings
  - sharebymail
  - support
  - systemtags
  - text
  - theming
  - twofactor_backupcodes
  - updatenotification
  - user_status
  - viewer
  - weather_status
  - workflowengine

nextcloud_password_length: "{{ rebeldream_password_length }}"

nextcloud_group_members: "({{ samba_member_of }}=cn=nextcloudusers,{{ rebeldream_user_dn }})"
nextcloud_samba_user_filter: "(&{{ samba_user_class }}{{ samba_search }}{{ samba_enabled_users }}{{ nextcloud_group_members }})"
nextcloud_samba_login_filter: "(&{{ samba_user_class }}{{ samba_enabled_users }}({{ nextcloud_group_members }})"
nextcloud_samba_group_filter: "(&{{ samba_group_class }}{{ nextcloud_group_members }}"

nextcloud_ldap_config_ids:
  - type: ldap
    id: s01
    ldap_config:
      - ldap_attribute: "ldapBase"
        ldap_value: "cn=users,{{ rebeldream_base_dn }}"
      - ldap_attribute: "ldapBaseUsers"
        ldap_value: "{{ rebeldream_user_dn }}"
      - ldap_attribute: "ldapBaseGgroups"
        ldap_value: "{{ rebeldream_group_dn }}"
      - ldap_attribute: "ldapUserDisplayName"
        ldap_value: "displayname"
      - ldap_attribute: "ldapAgentName"
        ldap_value: "cn=nextcloud,{{ rebeldream_user_dn }}"
      - ldap_attribute: "ldapAgentPassword"
        ldap_value: "{{ nextcloud_ldap_password }}"
      - ldap_attribute: "ldapEmailAttribute"
        ldap_value: "mail"
      - ldap_attribute: "ldapExpertUsernameAttr"
        ldap_value: "userPrincipalName"
      - ldap_attribute: "ldapGidNumber"
        ldap_value: "gidNumber"
      - ldap_attribute: "ldapGroupDisplayName"
        ldap_value: "cn"
      - ldap_attribute: "ldapGroupFilter"
        ldap_value: "{{ nextcloud_samba_group_filter }}"
      - ldap_attribute: "ldapGroupFilterMode"
        ldap_value: "0"
      - ldap_attribute: "ldapGroupMemberAssocAttr"
        ldap_value: "member"
      - ldap_attribute: "ldapHost"
        ldap_value: "192.168.0.2"
      - ldap_attribute: "ldapLoginFilter"
        ldap_value: "{{ nextcloud_samba_login_filter }}"
      - ldap_attribute: "ldapUserFilter"
        ldap_value: "{{ nextcloud_samba_user_filter }}"
      - ldap_attribute: "useMemberOfToDetectMembership"
        ldap_value: "1"

nextcloud_saml_config:
  - saml_attribute: "2-sp-name-id-format"
    saml_value: "urn:oasis:names:tc:SAML:1.1:nameid-format:unspecified"
  - saml_attribute: "enabled"
    saml_value: "yes"
  - saml_attribute: "general-allow_multiple_user_back_ends"
    saml_value: "1"
  - saml_attribute: "general-idp0_display_name"
    saml_value: "Keycloak"
  - saml_attribute: "general-require_provisioned_account"
    saml_value: "1"
  - saml_attribute: "general-uid_mapping"
    saml_value: "userPrincipalName"
            # "general-use_saml_auth_for_desktop": "1"
            # "idp-entityId": "https:\/\/warspite.swg.drbr.org\/auth\/realms\/olympus"
            # "idp-singleLogoutService.url": "https:\/\/warspite.swg.drbr.org\/auth\/realms\/olympus\/protocol\/saml"
            # "idp-singleSignOnService.url": "https:\/\/warspite.swg.drbr.org\/auth\/realms\/olympus\/protocol\/saml"
            # "idp-x509cert": "MIIClzCCAX8CBgF1WxsLYjANBgkqhkiG9w0BAQsFADAPMQ0wCwYDVQQDDAREcmJyMB4XDTIwMTAyNDE0NTMyMFoXDTMwMTAyNDE0NTUwMFowDzENMAsGA1UEAwwERHJicjCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAIn0drIfK+yvCDcZROgqiR1YqotuMPWfJChnit9xhKyFTTFXca\/Ck6uogn9u4v+olXahN3c9YTP9o9w5Fxz+lWMe\/2KgJmvTcfhS2Vzi1vNzVQxJHph94u3FcGbI6gRqfa0pfJLp0ThIkj5dn8yjPvkaeF8cLEhhVg36xiR9MlFBiQDee2+9VYrm5lJX6Dy9aTszNCjPHWzW4GLX2abJP+1lTAVOVgOOAZGGuOC+nHcMJS87Na0tJ+YVptHFvKg9HFd\/NlkoyrHqpCzpGS1aIfE1qp\/xmFzbLC4Ky8lKfTnY6H7VaqiKiHbEkkFdXGvfUjkv\/xFsjP\/gX+7DUk0hh3kCAwEAATANBgkqhkiG9w0BAQsFAAOCAQEAA95w7JRypDyNRU0JxpWyxPfxB\/9GMRzPKNDURR5V7w\/Wpx1qC2DvKiD2cxeYIGxjF2S+sixFyeLPX\/BP37L\/6iNyKGTA6kHXf\/sd08SZV2aFAL8mq6KBG4+BzgvYSbCG7OqcQvLfGzDZmjYwe8KrcbKDipcWssWbWEI6qKDxoUxrrxMuKtFfraQHXW9kAiaGoi2SRadfhWf+Jjyaz1\/RnVz02XgQD+7xhtdzptS5lvvnLn7LlSz4ZbbommbsFKwbxChuS67DthoNJoUXRRva5KLJKAnwzp8p++mX2et0hKuHNh36vdFM5AzctWAnFHCuTV7xkuNa7B8MHDWTIdMQjg=="
            # "installed_version": "3.3.1"
            # "providerIds": "1"
            # "security-authnRequestsSigned": "1"
            # "security-logoutRequestSigned": "1"
            # "security-logoutResponseSigned": "1"
            # "security-lowercaseUrlencoding": "1"
            # "security-nameIdEncrypted": "0"
            # "security-signMetadata": "0"
            # "security-wantAssertionsEncrypted": "0"
            # "security-wantAssertionsSigned": "1"
            # "security-wantMessagesSigned": "1"
            # "security-wantNameId": "0"
            # "security-wantXMLValidation": "0"
            # "sp-name-id-format": "urn:oasis:names:tc:SAML:1.1:nameid-format:unspecified"
            # "sp-privateKey": "MIIJKgIBAAKCAgEA2qW1L0YLU\/P1jKDLp2EvXI6ezndHiW7E85k\/27yo8jUg4QIF\n+vE\/2G+\/uVyp69mY++zEfszbsiVL7Vf4YKRZE+jvg2qSD0c6pZtiDjc+iy\/YFZQg\na+rFSpBYvNiuGN\/Swi64ZeUdnh+gJW7YK1onV3VX0MTEn\/j7T7T+COgrBMuXGiGK\n7iVedpJzYS0c9UV3o+2C5KjDNYadGypbingxwa+IZgPHd7vzuYSSfqPmI2mcR5fx\ncn1H1sab4prSITggcgWKj\/p1x3ydLqcn1ZkOgqITbb6HkAET8OUN2R5k4PNp0q7k\nn\/XU7\/j2dv0WDzYzY5WXr\/Q72WLUvNZDQVd7elbh2isKBRfp2gGSfoygBvhpVoN8\npVGHKHTaI9E4g2fBWt2N4pimtqI0dsfDbEmL86ksogve7R9x7ln48feU9IfFV69j\nzGrxJHbytPP0V\/ebI\/wOrXk83Z97LxgyMv0AVfvG1GkGSZtHSEIkNytft3LZUQSe\nvnfiKR5ZQfDyfmohz0+JetAaLmVkEGzGuBuTPSYnK\/mfSVFJBLpDNwxA+0zxKwLU\n7XbGkJRLt6PV+OEBKr3wj7e2e401yiBvXZoYzfx5YL7+sTu0w3oPcS3DER9R+pdO\nKiJGSNSr7Okq9QhYcmgz9G\/YDeq9FXqeWKmKZmpnk5Lmef5yoNmQznz3G4UCAwEA\nAQKCAgAzNhjH58oDceKTe533qEWlkioUBdAVmoI65CwW1Ytkn5kB2q1350Wi9hmb\n2t5ZxW+VohEr+eODSEUOZEpiqFvM1AQ1baKkPXS5ETnYRow5oY0lELq\/TA\/FtSVz\npfSxEsuUe8jo5M8ZGCM0YU\/0Z3tLesqEtXGwXmrOcoAFqgtZZi4QCsc1nD8R2p93\npU9hC1JIbPr5f6WpRcxKbpNeTWSqDukNq9jubHFbhHejfdQLe1MFWctNm5ZV8dLV\nMpoA+dpvmmin7Gvlu4Q9Rx2HZAAIDNosHDI4QmhfRecGcZ4DKkAg\/qHB7ZxgUJm5\nqPGfwnwq2QDcT4ItGn7lc\/HwvgLHZ+iWZEBmoL9U\/zFrrIhlK5KWQJIbUsFFJjta\nbpnSKlxaEg\/dZaH5Kwisn0wprNj0HVFt\/O1WjgRZi4+xGUHVmtIhmJNQWdHuDZZR\nG2HlY63tquYSRSs6qUeNf4VA2Qq+QyS9FfPWzC9uAnh9x2KKHy9w8jS+ChsBnPjI\nYJN\/ubphLPOYH0JGb5gPVp0GC1L2EzXyEliTi\/NWvsDSXTa2w2+lI6k06RitH9DW\nCzH9+3L6yFF6t8Ga85VzCcv7JA+CMVXNdaP4P29eHEONgbXRhCtEiZfytNGMXWad\nb\/kG7YSOiJIbVtRVAwKiCqprno7hoqh9yww2VlkNSzJtj0ObAQKCAQEA9QxKPVp8\nKuvzeEeiMrA5+s1G+jdLdsYHf52AZ97jF+Ma9ZgCoVo5wP3XHjOpwhjGhBY3kSu1\nBMU3rqYvJyG02V21+XKkwtaEADNP+ljqQiOjLa9vvVu\/R6c7mw72m\/D6ewhcp8vF\nopkBRwj\/Qs2lnJBBxUox39wqOtILHCwOSKgBrGZjiTWkB\/unssYIap1vqDxV5o4F\nOiAy2L8f6m50Q97ctvZzOR17\/Wq\/SvLmBK4v9knkgPIPqFnU85ltE4aGpHiz47lY\nGUt0n8yABMM\/y32CcBkXOFE\/wSQ0djN6oYGoOjUAErZJ2F3QRUu0Vfxq6yU7WDxw\npSYT7YLSXTV15QKCAQEA5Gta0C\/FNmgsii+g6dRJrCCVTdODESWHbtdLa\/KUZrUu\nsCALb572JFOMWanCtl62slIIcV802J3YMUo2CkW0abst21noXPvXm5lKmKCV8S8I\nlKwSWgYlPTUAWJFmxLtQdtqurdV4dqi0J1OmpjjaZ9Ic\/twzOLXqNYIfKOYNtoEg\nVehEoCTruv5sr0GeG3q7i0JOHUvwdegIYaxdWAoqAXWxvUU8IPLbrW1uOTL5BRFm\nVAm\/1xD1oWibB219P\/s1nj+aWpAy4tfSJOpr60U1hrd41tjPDpOm\/yJGGSJB9LTm\ncim3m8+\/nPfisG24sKPkuSlSIgPFmGq+JmWyLli1IQKCAQEAxypwBKHQncocnrwK\nFoyo8zF46NGcYjLd0VkgDkxX4whQ1x\/vs1jz6+nkt8VhykH8x0qPa0xM2k24zhh\/\n5pw8sxa5Wr9VLo7PxqHt9RnjfFIexHj8prk1JHXFumdVBLW9v9WyCSdTwK3\/Hc8w\nOQmP+0o8Sq\/dDYeSQzCImyMrkN4MTiUB7XlNkrd1O5Y9LPo80E4Ju1Pe57lX2lat\nCAsyMB+o4IQ6bkeKiRQD2lTFozQ4A0NXl34mP7yTmlIvF1mVgYQhIYt5EUYEygSa\nYESZSzj9lUKvXrSazs4wXYnFuBL7uiNtpcfHCTZmmovHTMPV2rzuGO821uO1+qsD\nc4KKCQKCAQEAzIqNsat1T\/kNGVj5ISpmJmqvCBgFYA9ZLZpBAZMh7K8F9dVcKEIS\nbAkcvxXTNHev5hKrWMpGikseU1T++0fb\/GoO8EOcXddvBPjJ4c67NlRFvMwxSsgC\nBMM3YhgiDL0nmqbMkQF9c9QyLp0rt+FlQl7WdCo+++N6rRuuR3NqiCktCYCKI1Ws\nebBnJrD9oeHPmy5uwLFFzG9RQhWVKMdBQjlgRfp\/k4mlybEaaMIKV81y8oIgdbfM\nHROM76PN6sNLCkAuOjayOovEtCXvKai5+77DyLAxCf6SJhlM6CjTIwvy5\/wPXMk1\n7pvTNOWr4xGAOYaU87yo7ol3aO7cFcB9wQKCAQEAhbK\/xqE2b9diLV6CdcIFImke\nV93t6tH\/s5M+p1oYEjD1j0ll4nQTGtcs05E18mX+yUde0EW+1Aei0c6cMI2kDVCb\nRNhB7ezg+3kVxdp5JyNdEe\/Y+gTaILk7trfOldSSJ+xIGKFB8BOQPumDZGO0exfJ\nPBusfvLe596IkACrAA2Ej54HBoXTIiGeWNaoTfdO2v0h8N+MPKohjFvNBVQPnF\/O\nkhTofABrxGpkLPG56tvVZ1h7p5wwXiS+CLGogJFRf9RWD0nFtcSZXYzLGb\/Hf9gp\n8rqk1MdKATDa1iuUKXOKIxdiE9U4Yit35JF9MVYQHQsu1kufjTvPX7zTBG+vXA=="
            # "sp-x509cert": "MIIGUzCCBTugAwIBAgISAyHcljdva\/43uT4DBNDPVgymMA0GCSqGSIb3DQEBCwUA\nMEoxCzAJBgNVBAYTAlVTMRYwFAYDVQQKEw1MZXQncyBFbmNyeXB0MSMwIQYDVQQD\nExpMZXQncyBFbmNyeXB0IEF1dGhvcml0eSBYMzAeFw0yMDEwMjIyMDM2NTBaFw0y\nMTAxMjAyMDM2NTBaMBkxFzAVBgNVBAMTDmNsb3VkLmRyYnIub3JnMIICIjANBgkq\nhkiG9w0BAQEFAAOCAg8AMIICCgKCAgEA2qW1L0YLU\/P1jKDLp2EvXI6ezndHiW7E\n85k\/27yo8jUg4QIF+vE\/2G+\/uVyp69mY++zEfszbsiVL7Vf4YKRZE+jvg2qSD0c6\npZtiDjc+iy\/YFZQga+rFSpBYvNiuGN\/Swi64ZeUdnh+gJW7YK1onV3VX0MTEn\/j7\nT7T+COgrBMuXGiGK7iVedpJzYS0c9UV3o+2C5KjDNYadGypbingxwa+IZgPHd7vz\nuYSSfqPmI2mcR5fxcn1H1sab4prSITggcgWKj\/p1x3ydLqcn1ZkOgqITbb6HkAET\n8OUN2R5k4PNp0q7kn\/XU7\/j2dv0WDzYzY5WXr\/Q72WLUvNZDQVd7elbh2isKBRfp\n2gGSfoygBvhpVoN8pVGHKHTaI9E4g2fBWt2N4pimtqI0dsfDbEmL86ksogve7R9x\n7ln48feU9IfFV69jzGrxJHbytPP0V\/ebI\/wOrXk83Z97LxgyMv0AVfvG1GkGSZtH\nSEIkNytft3LZUQSevnfiKR5ZQfDyfmohz0+JetAaLmVkEGzGuBuTPSYnK\/mfSVFJ\nBLpDNwxA+0zxKwLU7XbGkJRLt6PV+OEBKr3wj7e2e401yiBvXZoYzfx5YL7+sTu0\nw3oPcS3DER9R+pdOKiJGSNSr7Okq9QhYcmgz9G\/YDeq9FXqeWKmKZmpnk5Lmef5y\noNmQznz3G4UCAwEAAaOCAmIwggJeMA4GA1UdDwEB\/wQEAwIFoDAdBgNVHSUEFjAU\nBggrBgEFBQcDAQYIKwYBBQUHAwIwDAYDVR0TAQH\/BAIwADAdBgNVHQ4EFgQUcW9l\nlngJhcZqxAWv4BWwn2UfrPgwHwYDVR0jBBgwFoAUqEpqYwR93brm0Tm3pkVl7\/Oo\n7KEwbwYIKwYBBQUHAQEEYzBhMC4GCCsGAQUFBzABhiJodHRwOi8vb2NzcC5pbnQt\neDMubGV0c2VuY3J5cHQub3JnMC8GCCsGAQUFBzAChiNodHRwOi8vY2VydC5pbnQt\neDMubGV0c2VuY3J5cHQub3JnLzAZBgNVHREEEjAQgg5jbG91ZC5kcmJyLm9yZzBM\nBgNVHSAERTBDMAgGBmeBDAECATA3BgsrBgEEAYLfEwEBATAoMCYGCCsGAQUFBwIB\nFhpodHRwOi8vY3BzLmxldHNlbmNyeXB0Lm9yZzCCAQMGCisGAQQB1nkCBAIEgfQE\ngfEA7wB1AJQgvB6O1Y1siHMfgosiLA3R2k1ebE+UPWHbTi9YTaLCAAABdVI+NsQA\nAAQDAEYwRAIgcIOrZP39kSL9wrkDxMBveggAkv\/g82Q7\/SIUoCl7zOUCIHHE4uib\ngIZj1q2nUUStBODJK0CYXnVxBHD3Ey3CD4v5AHYAfT7y+I\/\/iFVoJMLAyp5SiXkr\nxQ54CX8uapdomX4i8NcAAAF1Uj43KAAABAMARzBFAiEAgwY3oXui1DlMkQE7cqgV\nR7zmgqmBFI0oJEADT6lW564CIHIOJp7OxYQILmGS5LRWHvMyWPQl10TMka8x\/t5o\n5y2MMA0GCSqGSIb3DQEBCwUAA4IBAQAsD7JnK63N1Wl2w47ArqQC9p3yg8xqgbJe\n4w4Ro62PS4u8N85D1IcoLiSr7RC6+4V0GZ5JMhq0S1oGVxe5XcDXybjkInnoLLpU\nAEGw9me2mdfMOlTxJEPPhw\/0M7oIxZCc5jU3h0USI\/HaxDrSBrlfwPYH\/hk2b6pe\nZCUYAl6zwPl0AuslT6WNY1kSORutsF\/dhpdnnQwtaEOPpbPlMq5Tty3ekdzfD37c\n2zBKTnqlgU4CTQDQknoA\/XZglu9tpQGscdWblI3gcgKOgw91N89vjZeiSWwmDi\/G\nelPWv\/2UKH7BEbJNTxs+d1r2eZr+NisD978OvFsZ6KAblTZC7V5g"
            # "type": "saml"
            # "types": "authentication"


# ==================================================================================================
#
# These variables are not to be edited
#
# ==================================================================================================
nextcloud_default_apps:
  - accessibility
  - activity
  - admin_audit
  - cloud_federation_api
  - comments
  - contactsinteraction
  - dashboard
  - dav
  - encryption
  - federatedfilesharing
  - federation
  - files
  - files_external
  - files_pdfviewer
  - files_rightclick
  - files_sharing
  - files_trashbin
  - files_versions
  - files_videoplayer
  - firstrunwizard
  - logreader
  - lookup_server_connector
  - nextcloud_announcements
  - notifications
  - oauth2
  - password_policy
  - photos
  - privacy
  - provisioning_api
  - recommendations
  - serverinfo
  - settings
  - sharebymail
  - support
  - survey_client
  - systemtags
  - text
  - theming
  - twofactor_backupcodes
  - updatenotification
  - user_ldap
  - user_status
  - viewer
  - weather_status
  - workflowengine
