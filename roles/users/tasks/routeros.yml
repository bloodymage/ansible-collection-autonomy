---
# ==================================================================================================
#
# Setup RouterOS users
#
# ==================================================================================================

# ==================================================================================================
#
# Ensure we can login with proper users
#
# ==================================================================================================
# - name: Test user
#   local_action: "command ssh -q -o BatchMode=yes -o ConnectTimeout=3 {{ inventory_hostname }} 'echo ok'"
#   register: test_user
#   ignore_errors: true
#   changed_when: false

# ==================================================================================================
#
# If we can't, create the user
#
# ==================================================================================================
# - name: Create Users
#   remote_user: "{{ test_user | success | ternary(omit, 'admin') }}"
#   routeros_command:
#     commands:
#       - /user add name={{ item.username }} password={{ item.password }} group={{ item.usergroup }}
#   with_items: "{{ users }}"

# ======================================================================
#
# Restrict access by IP Address
#
# ======================================================================
# - name: Restrict login access to specific IP range
#   routeros_command:
#     commands:
#       - /user set 0 allowed-address=x.x.x.x/yy

# ======================================================================
#
# Copy SSH Keys to Router
#
# ======================================================================
# - name: Copy SSH Keys to Router
#   copy:
#     src: ~/.ssh/id_rsa.pub
#     dest: id_rsa.pub

# ======================================================================
#
# Install SSH Keys
#
# ======================================================================
# - name: Install SSH Keys
#   routeros_command:
#     commands:
#       - /user ssh-keys import user={{ item.username }} public-key-file=id_rsa.pub
#   with_items: "{{ users }}"    

# ==================================================================================================
#
# Check that we can login with our newly created users
#
# ==================================================================================================

# ==================================================================================================
#
# If we can, check to see if 'admin' user still exists
#
# ==================================================================================================

# ==================================================================================================
#
# If we can login with newly created users and "admin" user still exists; delete the "admin" user
#
# ==================================================================================================
# - name: Delete default user
#   routeros_command:
#     commands:
#       - /user remove admin
