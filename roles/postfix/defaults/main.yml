---
# defaults file for postfix-server
packages:
  - postfix

postfix_alias_database: "hash:/etc/aliases"
postfix_alias_maps:
  - "hash:/etc/aliases"
postfix_append_dot_mydomain: "no"
postfix_biff: "no"
postfix_canonical_maps: "hash:/etc/postfix/canonical"
postfix_default_destination_concurrency_limit: 5
postfix_delay_warning_time: "4h"
postfix_disable_vrfy_command: "yes"
postfix_dovecot_destination_recipient_limit: 1
postfix_home_mailbox: "Maildir/"
postfix_inet_interfaces: "all"
postfix_inet_protocols: "all"
postfix_local_recipient_maps: "$virtual_mailbox_maps"
postfix_mailbox_size_limit: 0
postfix_mailbox_transport: "lmtp:unix:private/dovecot-lmtp"
postfix_milter_connect_macros: "j {daemon_name} v {if_name} _"
postfix_milter_default_action: "accept"
postfix_mydestination:
  - "$myhostname"
  - "localhost.{{ rebeldream_domain }}"
  - "localhost"
postfix_non_smtpd_milters: "$smtpd_milters"
postfix_postscreen_access_list: "permit_mynetworks"
postfix_postscreen_dnsbl_action: "enforce"
postfix_postscreen_dnsbl_sites:
  - "zen.spamhaus.org"
  - "b.barracudacentral.org"
  - "bl.spamcop.net"
postfix_postscreen_greet_action: "enforce"
postfix_readme_directory: "no"
postfix_relay_destination_concurrency_limit: 1
postfix_sender_dependent_relayhost_maps: "hash:/etc/postfix/sender_relay"
postfix_smtp_sasl_auth_enable: "yes"
postfix_smtp_sasl_password_maps: "hash:/etc/postfix/sasl_passwd"
postfix_smtp_sasl_security_options: "noanonymous"
postfix_smtp_sender_dependent_authentication: "yes"
postfix_smtp_tls_note_starttls_offer: "yes"
postfix_smtp_tls_security_level: "may"
postfix_smtp_tls_session_cache_database: "btree:${data_directory}/smtp_cache"
postfix_smtp_tls_wrappermode: "no"
postfix_smtpd_banner: "$myhostname ESMTP"
postfix_smtpd_client_restrictions:
  - "permit_mynetworks"
  - "permit_sasl_authenticated"
  - "permit_tls_clientcerts"
  - "reject"
postfix_smtpd_helo_restrictions:
  - "permit_mynetworks"
  - "permit_sasl_authenticated"
  - "reject_invalid_helo_hostname"
  - "reject_non_fqdn_helo_hostname"
  - "reject_unknown_helo_hostname"
  - "check_helo_access hash:/etc/postfix/helo_access"
postfix_smtpd_helo_required: "yes"
postfix_smtpd_milters:
  - "unix:/spamass/spamass.sock"
postfix_smtpd_recipient_restrictions:
  - "permit_sasl_authenticated"
  - "permit_mynetworks"
  - "permit_auth_destination"
  - "reject_unknown_client_hostname"
  - "reject_unknown_sender_domain"
  - "reject_unknown_recipient_domain"
  - "reject_unauth_pipelining"
  - "reject_unauth_destination"
  - "reject_invalid_hostname"
  - "reject_non_fqdn_sender"
postfix_smtpd_relay_restrictions:
  - "permit_auth_destination"
  - "permit_mynetworks"
  - "permit_sasl_authenticated"
  - "reject_unauth_destination"
postfix_smtpd_sasl_auth_enable: "yes"
postfix_smtpd_sasl_authenticated_header: "yes"
postfix_smtpd_sasl_local_domain: "$myhostname"
postfix_smtpd_sasl_path: "private/auth"
postfix_smtpd_sasl_security_options: "noanonymous"
postfix_smtpd_sasl_tls_security_options: "$smtpd_sasl_security_options"
postfix_smtpd_sasl_type: "dovecot"
postfix_smtpd_sender_login_maps:
  - "$virtual_mailbox_maps"
postfix_smtpd_sender_restrictions:
  - "permit_sasl_authenticated"
  - "permit_mynetworks"
  - "reject_unknown_sender_domain"
  - "reject_sender_login_mismatch"
postfix_smtpd_tls_CAfile: "/etc/ssl/cert/example-cert.pem"
postfix_smtpd_tls_ask_ccert: "yes"
postfix_smtpd_tls_auth_only: "yes"
postfix_smtpd_tls_cert_file:  "/etc/ssl/certs/{{ ansible_fqdn }}.pem"
postfix_smtpd_tls_ciphers: "high"
postfix_smtpd_tls_key_file:  "/etc/ssl/private/{{ ansible_fqdn }}.key"
postfix_smtpd_tls_loglevel: 1
postfix_smtpd_tls_received_header: "yes"
postfix_smtpd_tls_session_cache_database: "btree:${data_directory}/smtpd_cache"
postfix_smtpd_tls_session_cache_timeout: "3600s"
postfix_smtpd_use_tls: "yes"

postfix_tls_random_source: "dev:/dev/urandom"
postfix_transport_maps: "hash:/etc/postfix/transport"
postfix_unknown_address_reject_code: "550"
postfix_unknown_client_reject_code: "550"
postfix_unknown_hostname_reject_code: "550"
postfix_virtual_alias_maps:
  - "hash:/etc/postfix/virtual"
postfix_virtual_mailbox_domains:
  - "hash:/etc/postfix/virtual-mailbox-domains"
postfix_virtual_mailbox_maps:
  - "hash:/etc/postfix/virtual-mailbox-users"
postfix_virtual_transport: "dovecot"

postfix_master_submission_options:
  - "-o smtpd_tls_security_level=encrypt"
  - "-o smtpd_sasl_auth_enable=yes"
  - "-o smtpd_sasl_type=dovecot"
  - "-o smtpd_sasl_path=private/auth"
  - "-o smtpd_sasl_security_options=noanonymous"
  - "-o smtpd_sasl_local_domain=$myhostname"
  - "-o smtpd_client_restrictions=permit_sasl_authenticated,reject"
  - "-o smtpd_sender_login_maps=hash:/etc/postfix/virtual"
  - "-o smtpd_sender_restrictions=reject_sender_login_mismatch"
  - "-o smtpd_recipient_restrictions=reject_non_fqdn_recipient,reject_unknown_recipient_domain,permit_sasl_authenticated,reject"

postfix_master_smtps_options:
  - "-o smtpd_tls_wrappermode=yes"
  - "-o smtpd_sasl_auth_enable=yes"

postfix_master_relay_options:
  - "-o syslog_name=postfix/$service_name"

postfix_master_maildrop_options:
  - "flags=DRhu user=vmail argv=/usr/bin/maildrop -d ${recipient}"

postfix_master_uucp_options:
  - "flags=Fqhu user=uucp argv=uux -r -n -z -a$sender - $nexthop!rmail ($recipient)"

postfix_master_ifmail_options:
  - "flags=F user=ftn argv=/usr/lib/ifmail/ifmail -r $nexthop ($recipient)"

postfix_master_bsmtp_options:
  - "flags=Fq. user=bsmtp argv=/usr/lib/bsmtp/bsmtp -t$nexthop -f$sender $recipient"

postfix_master_scalemail_options:
  - "flags=R user=scalemail argv=/usr/lib/scalemail/bin/scalemail-store ${nexthop} ${user} ${extension}"

postfix_master_mailman_options:
  - "flags=FR user=list argv=/usr/lib/mailman/bin/postfix-to-mailman.py"
  - "${nexthop} ${user}"

postfix_master_dovecot_options:
  - "flags=DRhu user=vmail:vmail argv=/usr/lib/dovecot/deliver"
  - "-f ${sender} -d ${user}@${nexthop} -a ${original_recipient}"

postfix_canonical_mappings: []
postfix_ldap_maps: []
postfix_ldap_map_debug_level: 0
