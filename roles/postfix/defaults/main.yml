---
# defaults file for postfix-server
packages:
  - postfix

mail_user: vmail

alias_database: "hash:/etc/aliases"
alias_maps:
  - "hash:/etc/aliases"
append_dot_mydomain: "no"
biff: "no"
canonical_maps: "hash:/etc/postfix/canonical"
default_destination_concurrency_limit: 5
delay_warning_time: "4h"
disable_vrfy_command: "yes"
dovecot_destination_recipient_limit: 1
home_mailbox: "Maildir/"
inet_interfaces: "all"
inet_protocols: "all"
local_recipient_maps: "$virtual_mailbox_maps"
mailbox_size_limit: 0
mailbox_transport: "lmtp:unix:private/dovecot-lmtp"
milter_connect_macros: "j {daemon_name} v {if_name} _"
milter_default_action: "accept"
mydestination:
  - "$myhostname"
  - "localhost.{{ ansible_domain }}"
  - "localhost"
non_smtpd_milters: "$smtpd_milters"
postscreen_access_list: "permit_mynetworks"
postscreen_dnsbl_action: "enforce"
postscreen_dnsbl_sites:
  - "zen.spamhaus.org"
  - "b.barracudacentral.org"
  - "bl.spamcop.net"
postscreen_greet_action: "enforce"
readme_directory: "no"
recipient_delimiter: "."
relay_destination_concurrency_limit: 1
sender_dependent_relayhost_maps: "hash:/etc/postfix/sender_relay"
smtp_sasl_auth_enable: "yes"
smtp_sasl_password_maps: "hash:/etc/postfix/sasl_passwd"
smtp_sasl_security_options: "noanonymous"
smtp_sender_dependent_authentication: "yes"
smtp_tls_note_starttls_offer: "yes"
smtp_tls_security_level: "may"
smtp_tls_session_cache_database: "btree:${data_directory}/smtp_cache"
smtp_tls_wrappermode: "no"
smtpd_banner: "$myhostname ESMTP"
smtpd_client_restrictions:
  - "permit_mynetworks"
  - "permit_sasl_authenticated"
  - "permit_tls_clientcerts"
  - "reject"
smtpd_helo_restrictions:
  - "permit_mynetworks"
  - "permit_sasl_authenticated"
  - "reject_invalid_helo_hostname"
  - "reject_non_fqdn_helo_hostname"
  - "reject_unknown_helo_hostname"
  - "check_helo_access hash:/etc/postfix/helo_access"
smtpd_helo_required: "yes"
smtpd_milters:
  - "unix:/spamass/spamass.sock"
smtpd_recipient_restrictions:
  - "permit_sasl_authenticated"
  - "permit_mynetworks"
  - "permit_auth_destination"
  - "reject_unknown_client_hostname"
  - "reject_unknown_sender_domain"
  - "reject_unknown_recipient_domain"
  - "reject_unauth_pipelining"
  - "reject_unauth_destination"
  - "reject_invalid_hostname"
  - "reject_non_fqdn_sender"
smtpd_relay_restrictions:
  - "permit_auth_destination"
  - "permit_mynetworks"
  - "permit_sasl_authenticated"
  - "reject_unauth_destination"
smtpd_sasl_auth_enable: "yes"
smtpd_sasl_authenticated_header: "yes"
smtpd_sasl_local_domain: "$myhostname"
smtpd_sasl_path: "private/auth"
smtpd_sasl_security_options: "noanonymous"
smtpd_sasl_tls_security_options: "$smtpd_sasl_security_options"
smtpd_sasl_type: "dovecot"
smtpd_sender_login_maps:
  - "$virtual_mailbox_maps"
smtpd_sender_restrictions:
  - "permit_sasl_authenticated"
  - "permit_mynetworks"
  - "reject_unknown_sender_domain"
  - "reject_sender_login_mismatch"
smtpd_tls_CAfile: "/etc/ssl/cert/example-cert.pem"
smtpd_tls_ask_ccert: "yes"
smtpd_tls_auth_only: "yes"
smtpd_tls_cert_file:  "/etc/ssl/certs/{{ ansible_fqdn }}.pem"
smtpd_tls_ciphers: "high"
smtpd_tls_key_file:  "/etc/ssl/private/{{ ansible_fqdn }}.key"
smtpd_tls_loglevel: 1
smtpd_tls_received_header: "yes"
smtpd_tls_session_cache_database: "btree:${data_directory}/smtpd_cache"
smtpd_tls_session_cache_timeout: "3600s"
smtpd_use_tls: "yes"

tls_random_source: "dev:/dev/urandom"
transport_maps: "hash:/etc/postfix/transport"
unknown_address_reject_code: "550"
unknown_client_reject_code: "550"
unknown_hostname_reject_code: "550"
virtual_alias_maps:
  - "hash:/etc/postfix/virtual"
virtual_mailbox_domains:
  - "hash:/etc/postfix/virtual-mailbox-domains"
virtual_mailbox_maps:
  - "hash:/etc/postfix/virtual-mailbox-users"
virtual_transport: "dovecot"

master_submission_options:
  - "-o smtpd_tls_security_level=encrypt"
  - "-o smtpd_sasl_auth_enable=yes"
  - "-o smtpd_sasl_type=dovecot"
  - "-o smtpd_sasl_path=private/auth"
  - "-o smtpd_sasl_security_options=noanonymous"
  - "-o smtpd_sasl_local_domain=$myhostname"
  - "-o smtpd_client_restrictions=permit_sasl_authenticated,reject"
  - "-o smtpd_sender_login_maps=hash:/etc/postfix/virtual"
  - "-o smtpd_sender_restrictions=reject_sender_login_mismatch"
  - "-o smtpd_recipient_restrictions=reject_non_fqdn_recipient,reject_unknown_recipient_domain,permit_sasl_authenticated,reject"

master_smtps_options:
  - "-o smtpd_tls_wrappermode=yes"
  - "-o smtpd_sasl_auth_enable=yes"

master_relay_options:
  - "-o syslog_name=postfix/$service_name"

master_maildrop_options:
  - "flags=DRhu user=vmail argv=/usr/bin/maildrop -d ${recipient}"

master_uucp_options:
  - "flags=Fqhu user=uucp argv=uux -r -n -z -a$sender - $nexthop!rmail ($recipient)"

master_ifmail_options:
  - "flags=F user=ftn argv=/usr/lib/ifmail/ifmail -r $nexthop ($recipient)"

master_bsmtp_options:
  - "flags=Fq. user=bsmtp argv=/usr/lib/bsmtp/bsmtp -t$nexthop -f$sender $recipient"

master_scalemail_options:
  - "flags=R user=scalemail argv=/usr/lib/scalemail/bin/scalemail-store ${nexthop} ${user} ${extension}"


master_mailman_options:
  - "flags=FR user=list argv=/usr/lib/mailman/bin/postfix-to-mailman.py"
  - "${nexthop} ${user}"

master_dovecot_options:
  - "flags=DRhu user=vmail:vmail argv=/usr/lib/dovecot/deliver"
  - "-f ${sender} -d ${user}@${nexthop} -a ${original_recipient}"
