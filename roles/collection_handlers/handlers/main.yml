---
# handlers file for collection_handlers
- name: Update System CA Certificates
  command:
    cmd: "update-ca-certificates"
  become: yes
  listen: "restart all"

# ==================================================================================================
#
# Restart Service Handlers
#
# ==================================================================================================
- name: Restart Apache
  ansible.builtin.service:
    name: apache2
    state: restarted
  listen:
    - "restart all"
    - "restart tls"
  become: yes
  when:
    - inventory_hostname in groups['apache_servers'] | default([])

- name: Restart Bind9
  ansible.builtin.service:
    name: bind9
    state: restarted
  listen:
    - "restart all"
    - "restart tls"
  become: yes
  when:
    - inventory_hostname in groups['dns_servers'] | default([])

- name: Restart Dovecot
  ansible.builtin.service:
    name: dovecot
    state: restarted
  listen:
    - "restart all"
    - "restart tls"
  become: yes
  when:
    - inventory_hostname in groups['dovecot_servers'] | default([])

- name: Restart Mosquitto
  ansible.builtin.service:
    name: mosquitto
    state: restarted
  listen:
    - "restart all"
    - "restart tls"
  become: yes
  when:
    - inventory_hostname in groups['mosquitto_servers'] | default([])

- name: Restart MySQL
  ansible.builtin.service:
    name: mysql
    state: restarted
  listen:
    - "restart all"
    - "restart tls"
  become: yes
  when:
    - inventory_hostname in groups ['mysql_compatable_servers'] | default([])

- name: Restart nginx
  ansible.builtin.service:
    name: nginx
    state: restarted
  listen:
    - "restart all"
    - "restart tls"
  become: yes
  when:
    - inventory_hostname in groups ['nginx_servers'] | default([])

- name: Restart Postfix
  ansible.builtin.service:
    name: postfix
    state: restarted
  listen:
    - "restart all"
    - "restart tls"
  become: yes
  when:
    - inventory_hostname in groups['postfix_servers'] | default([])

- name: Restart Samba Domain Controller
  ansible.builtin.service:
    name: samba-ad-dc
    state: restarted
  listen:
    - "restart all"
    - "restart tls"
  become: yes
  when:
    - inventory_hostname in groups['samba_domain_controllers'] | default([])

- name: Restart SMBD Server
  ansible.builtin.service:
    name: smbd
    state: restarted
  listen:
    - "restart all"
    - "restart tls"
    - "restart samba file server"
  become: yes
  when:
    - inventory_hostname in groups['samba_file_servers']

- name: Restart NMBD Server
  ansible.builtin.service:
    name: nmbd
    state: restarted
  listen:
    - "restart all"
    - "restart tls"
    - "restart samba file server"
  become: yes
  when:
    - inventory_hostname in groups['samba_file_servers']

- name: Restart SSH Server
  ansible.builtin.service:
    name: ssh
    state: restarted
  listen:
    - "restart all"
  become: yes

- name: Restart Winbind Server
  ansible.builtin.service:
    name: winbind
    state: restarted
  listen:
    - "restart all"
    - "restart tls"
    - "restart samba file server"
  become: yes
  when:
    - inventory_hostname in groups['samba_file_servers']

- name: restart sssd
  ansible.builtin.service:
    name: sssd
    state: restarted
  become: yes
  listen:
    - "restart all"
    - "restart tls"
  when:
    - inventory_hostname in groups['sssd']

# ==================================================================================================
#
# Reload Handlers
#
# ==================================================================================================
- name: reload apache
  ansible.builtin.service:
    name: apache2
    state: reloaded
  listen:
    - "reload all"
  become: yes
  when:
    - inventory_hostname in groups['apache_servers']

- name: reload nginx
  ansible.builtin.service:
    name: nginx
    state: reloaded
  listen:
    - "reload all"
  become: yes
  when:
    - inventory_hostname in groups['nginx_servers']

- name: reload postfix
  ansible.builtin.service:
    name: postfix
    state: reloaded
  become: yes
  listen:
    - "reload all"
  when:
    - inventory_hostname in groups['postfix_servers']

# ==================================================================================================
#
# Start Handlers
#
# ==================================================================================================
- name: start sssd
  ansible.builtin.service:
    name: sssd
    state: started
  become: yes
  when:
    - inventory_hostname in groups['sssd']
