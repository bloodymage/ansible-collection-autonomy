---
# ==================================================================================================
#
#
#
# ==================================================================================================
- name: Ensure User Home directory exists
  ansible.builtin.file:
    dest: "{{ item.unix_home }}"
    state: directory
    owner: "{{ item.username }}"
    group: "{{ item.username }}"
    mode: "0700"
  loop: "{{ users }}"
  become: yes
  when:
    - users is defined
    - item.unix_home is defined
    - (item.login_shell is not defined) or (item.login_shell != "/usr/sbin/nologin")
  tags:
    - dotfiles
    - dotfiles_debug
    - dotfiles-debug

- name: Install User gitconfig
  ansible.builtin.template:
    src: "gitconfig.j2"
    dest: "{{ item.unix_home }}/.gitconfig"
    owner: "{{ item.username }}"
    group: "{{ item.username }}"
    mode: "0644"
  loop: "{{ users }}"
  become: yes
  when:
    - users is defined
    - (item.shell is not defined) or (item.shell != "/usr/sbin/nologin")
  tags:
    - dotfiles
    - dotfiles_debug
    - dotfiles-debug

- name: Ensure user .gnupg folder exists
  ansible.builtin.file:
    path: "{{ item.unix_home }}/.gnupg"
    state: directory
    owner: "{{ item.username }}"
    group: "{{ item.username }}"
    mode: "0700"
  loop: "{{ users }}"
  become: yes
  when:
    - users is defined
    - (item.shell is not defined) or (item.shell != "/usr/sbin/nologin")
  tags:
    - dotfiles
    - dotfiles_debug
    - dotfiles-debug

- name: Install gpg.conf
  ansible.builtin.template:
    src: "gpg.conf.j2"
    dest: "{{ item.unix_home }}/.gnupg/gpg.conf"
    owner: "{{ item.username }}"
    group: "{{ item.username }}"
    mode: "0644"
  loop: "{{ users }}"
  become: yes
  when:
    - users is defined
    - (item.shell is not defined) or (item.shell != "/usr/sbin/nologin")
  tags:
    - dotfiles
    - dotfiles_debug
    - dotfiles-debug

- name: Install gpg-agent.conf
  ansible.builtin.template:
    src: "gpg-agent.conf.j2"
    dest: "{{ item.unix_home }}/.gnupg/gpg-agent.conf"
    owner: "{{ item.username }}"
    group: "{{ item.username }}"
    mode: "0644"
  loop: "{{ users }}"
  become: yes
  when:
    - (item.shell is not defined) or (item.shell != "/usr/sbin/nologin")
  tags:
    - dotfiles
    - dotfiles_debug
    - dotfiles-debug
